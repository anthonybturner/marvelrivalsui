<div class="match-history-container">
  <div class="match-history-layout">
    <div class="match-list-panel">
      <div class="match-header">
        <!-- Search Bar -->
        <div class="hero-search">
          <form #searchForm="ngForm">
            <input type="text" class="search-box" name="playerName" [(ngModel)]="searchPlayerName"
              placeholder="Search player..." (ngModelChange)="onSearchInput($event)" />
          </form>
        </div>
      </div>
      @if (isLoading()) {
        <div class="loading-indicator">
          Loading match history...
        </div>
      }
      @if (!isLoading()) {
        <div class="no-matches">
          @for (match of matchHistory(); track match) {
            <div [ngClass]="{'win': match.match_winner_side, 'loss': !match.match_winner_side}" class="match-history-card" (click)="onMatchClick(match)">
              <img [src]="getMatchMapThumbnail(match.map_thumbnail)" [alt]="'Map ' + match.match_map_id" class="map-thumb" />
              <div class="match-meta">
                <div class="meta-row"><span class="meta-label">Map:</span> {{ match.match_map_name }} <span class="meta-id">({{ match.match_map_id }})</span></div>
                <div class="meta-row"><span class="meta-label">Season:</span> {{ match.match_season }}</div>
                <div class="meta-row"><span class="meta-label">Duration:</span> {{ match.match_play_duration }}</div>
                <div class="meta-row"><span class="meta-label">Date:</span> {{ match.match_time_stamp * 1000 | date:'medium' }}</div>
                <div class="meta-row"><span class="meta-label">Game Mode:</span> {{ getGameMode(match.game_mode_id) }}</div>
                <div class="meta-row"><span class="meta-label">Play Mode:</span> {{ match.play_mode_id }}</div>
                <div class="meta-row"><span class="meta-label">Winner Side:</span> <span [class.win]="match.match_winner_side" [class.loss]="!match.match_winner_side">{{ match.match_winner_side ? 'Yes': 'No' }}</span></div>
                <div class="meta-row"><span class="meta-label">Final Score:</span>
                @for (entry of match.score_info | keyvalue; track entry; let last = $last) {
                  {{ entry.value }}@if (!last) {
                  <span> - </span>
                }
              }
            </div>
          </div>
          <div class="player-stats">
            <div class="hero-info">
              <img [src]="'https://marvelrivalsapi.com/rivals/' + match.match_player.player_hero.hero_type"
                [alt]="match.match_player.player_hero.hero_name" class="hero-icon" />
              <span class="hero-name">{{ match.match_player.player_hero.hero_name | titlecase }}</span>
            </div>
            <div class="stat-row">
              <span class="stat kills"><b>K:</b> {{ match.match_player.kills }}</span>
              <span class="stat deaths"><b>D:</b> {{ match.match_player.deaths }}</span>
              <span class="stat assists"><b>A:</b> {{ match.match_player.assists }}</span>
              <span class="stat win"><b>Win:</b>
            </span>
            <span class="stat disconnect"><b>DC:</b>
            <mat-icon color="warn">{{ match.match_player.disconnected ? 'warning' : 'check_circle' }}</mat-icon>
          </span>
        </div>
        <div class="stat-row">
          <span><b>Hero K/D/A:</b> {{ match.match_player.player_hero.kills }}/{{ match.match_player.player_hero.deaths }}/{{ match.match_player.player_hero.assists }}</span>
          <span><b>Hero Damage:</b> {{ match.match_player.player_hero.total_hero_damage | number }}</span>
          <span><b>Damage Taken:</b> {{ match.match_player.player_hero.total_damage_taken | number }}</span>
          <span><b>Hero Heal:</b> {{ match.match_player.player_hero.total_hero_heal | number }}</span>
        </div>
        <div class="stat-row">
          <span><b>Score Î”:</b> {{ match?.match_player?.score_info?.add_score | number:'1.0-2' }}</span>
          <span><b>Level:</b> {{ match?.match_player?.score_info?.level }}</span>
          <span><b>New Level:</b> {{ match?.match_player?.score_info?.new_level }}</span>
          <span><b>New Score:</b> {{ match?.match_player?.score_info?.new_score | number:'1.0-2' }}</span>
        </div>
      </div>
    </div>
  }
</div>
}
</div>
<div class="match-details-panel">
  <router-outlet></router-outlet>
</div>
</div>
</div>