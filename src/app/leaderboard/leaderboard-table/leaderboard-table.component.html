<input type="text" class="search-input leaderboard" placeholder="Search player..." [(ngModel)]="searchTerm" (ngModelChange)="applyFilter()" />
<table mat-table [dataSource]="filteredPlayers" class="leaderboard-table">
  <!-- Rank Column -->
  <ng-container matColumnDef="rank">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('rank')">
      Rank
      @if (sortColumn === 'rank') {
        <span class="sort-arrow">
          {{sortAscending ? '▲' : '▼'}}
        </span>
      }
    </th>
    <td mat-cell *matCellDef="let player">
      <span class="rank-badge">#{{player.info.rank_season.rank_score}}</span>
    </td>
  </ng-container>

  <!-- Player Column -->
  <ng-container matColumnDef="player">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('player')">Player</th>
    <td mat-cell *matCellDef="let player" class="player-cell" (click)="onPlayerClick(player)">
      <div class="player-avatar">
        <img [src]="getPlayerImage(player.info.icon?.player_icon)" [alt]="player.info.name" />
      </div>
      <div class="player-info">
        <span class="player-name">{{player.info.name}}</span>
        <span class="player-id">ID: {{player.player_uid}}</span>
      </div>
    </td>
  </ng-container>

  <!-- Level Column -->
  <ng-container matColumnDef="level">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('level')">Level</th>
    <td mat-cell *matCellDef="let player">{{player.info.rank_season.level}}</td>
  </ng-container>

  <!-- Matches Column -->
  <ng-container matColumnDef="matches">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('matches')">Matches</th>
    <td mat-cell *matCellDef="let player">{{player.matches}}</td>
  </ng-container>

  <!-- Wins Column -->
  <ng-container matColumnDef="wins">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('wins')">Wins</th>
    <td mat-cell *matCellDef="let player">{{player.wins}}</td>
  </ng-container>

  <!-- Losses Column -->
  <ng-container matColumnDef="losses">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('losses')">Losses</th>
    <td mat-cell *matCellDef="let player">{{player.matches - player.wins}}</td>
  </ng-container>

  <!-- Win Rate Column -->
  <ng-container matColumnDef="winRate">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('winRate')">Win %</th>
    <td mat-cell *matCellDef="let player">
      @if (player.matches) {
        {{ ((player.wins / player.matches) * 100) | number:'1.0-2' }}%
      } @else {
        0%
      }
    </td>
  </ng-container>

  <!-- KDA Column -->
  <ng-container matColumnDef="kda">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('kda')">KDA</th>
    <td mat-cell *matCellDef="let player">
      {{player.kills}} / {{player.deaths}} / {{player.assists}}
    </td>
  </ng-container>

  <!-- Kills Column -->
  <ng-container matColumnDef="kills">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('kills')">Kills</th>
    <td mat-cell *matCellDef="let player">{{player.kills}}</td>
  </ng-container>

  <!-- Deaths Column -->
  <ng-container matColumnDef="deaths">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('deaths')">Deaths</th>
    <td mat-cell *matCellDef="let player">{{player.deaths}}</td>
  </ng-container>

  <!-- Assists Column -->
  <ng-container matColumnDef="assists">
    <th mat-header-cell *matHeaderCellDef (click)="sortData('assists')">Assists</th>
    <td mat-cell *matCellDef="let player">{{player.assists}}</td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="player-row"></tr>
</table>